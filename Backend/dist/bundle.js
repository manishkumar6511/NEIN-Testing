(()=>{var e={935:(e,r,o)=>{const t=o(874),n=(o(84),t.createConnection({host:"localhost",user:"root",password:"",database:"ormdb"})),s=t.createConnection({host:"localhost",user:"root",password:"",database:"leavemanagement"}),a=t.createConnection({host:"localhost",user:"root",password:"",database:"test"});e.exports={ormdb:n,leavemanagement:s,test:a}},321:(e,r,o)=>{const t=o(252)(),n=o(896),s=o(48),a=o(716),{ormdb:c}=o(935),i=o(461),l=o(928),u=i.diskStorage({destination:(e,r,o)=>{o(null,l.dirname((e=>{const r=a(),o=r.year(),t=r.format("MM"),s=r.format("DD"),c=r.format("HH"),i=l.join("E:/neinSoft/files/Nippon-OR/Upload",`${o}/${t}/${s}/${c}`);return n.existsSync(i)||n.mkdirSync(i,{recursive:!0}),l.join(i,e)})(r.originalname)))},filename:(e,r,o)=>{o(null,r.originalname)}}),_=i({storage:u}),d=o(23);t.post("/upload",_.single("file"),(async(e,r)=>{const o=[];if(console.log("this is the upload "),!e.file)return r.status(400).send("No file uploaded.");const t=e.file.path;try{const e=await new Promise(((e,r)=>{const o=[];n.createReadStream(t).pipe(s()).on("headers",(e=>{e=e.map((e=>e.trim()))})).on("data",(e=>{const r={};Object.keys(e).forEach((o=>{r[o.trim()]=e[o]?e[o].trim():""})),o.push(r)})).on("end",(()=>{e(o)})).on("error",(e=>{r(e)}))})),i=d.promisify(c.query).bind(c);for(const r of e){const e=r.Branch||"",t=r.Division||"",n=r["Invoice No."]||"",s=r["Issue Date"],a=r["Sales group"]||"",c=r["Airway Bill No."]||"",l=r["Master Airway Bill No."]||"",u=r["Reference No."]||"",_=r["Bill To Name"]||"",d=r["Shipper Name"]||"",E=r["Consignee Name"]||"",N=r["S/R Date"],f=r["S/R No."]||"",A=r["Amount (LCR)"]||"",O=r["Account Code"]||"",g=r["Invoice Create Date"],h="SELECT count(InvoiceNo) AS count FROM finance_master_data WHERE InvoiceNo = ?";if((await i(h,[n]))[0].count>0)console.log("Duplicate entry found. Skipping insert.");else{const h="\n                    INSERT INTO financedata (\n                        Branch, Division, InvoiceNo, IssueDate, Salesgroup, \n                        AirwayBillNo, MasterAirwayBillNo, ReferenceNo, BillToName, \n                        ShipperName, ConsigneeName, S_R_Date, S_R_No,\n                        Amount, Account_Code, Invoice_Create_Date\n                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",I=await i(h,[e,t,n,s,a,c,l,u,_,d,E,N,f,A,O,g]);console.log("Row inserted:",I.insertId),o.push(r)}}if(o.length>0){const e=(e=>{const r={};return e.forEach((e=>{const o=e.Branch,t=e.Division,n=e["Invoice No."],s=e["Airway Bill No."],a=e["Issue Date"],c=parseFloat(e["Amount (LCR)"]||0),i=e["Account Code"],l=parseFloat(e["Amount (LCR)"]||0);r[n]||(r[n]={Branch:o,Division:t,AirwayBillNo:s,IssueDate:a,Amount:c,Revenue:0,Reimbursement:0,GST:0});const u=parseInt(i.slice(0,3),10);i.startsWith("3")||i.startsWith("218")?r[n].Revenue+=l:u>=261&&u<=278?r[n].GST+=l:i.startsWith("2")&&!i.startsWith("218")&&(r[n].Reimbursement+=l)})),Object.keys(r).forEach((e=>{const o=r[e],t=o.Revenue+o.Reimbursement+o.GST;o.Status=Math.abs(t-o.Amount)<1e-4,o.Status||(console.log("Error in Invoice send mail "),console.log("sending mail...."))})),r})(o);a=e,Object.keys(a).forEach((e=>{const r=a[e];c.query("\n            INSERT INTO finance_master_data (Branch,Division,\n                InvoiceNo, AirwayBillNo, IssueDate, Amount, Revenue, Reimbursement, GST, Status\n            ) VALUES (?,?,?, ?, ?, ?, ?, ?, ?, ?)\n        ",[r.Branch,r.Division,e,r.AirwayBillNo,r.IssueDate,r.Amount,r.Revenue,r.Reimbursement,r.GST,r.Status],((e,r)=>{e?console.error("Database error:",e):console.log("Master row inserted:",r.insertId)}))}))}console.log("CSV file successfully processed"),r.status(200).send("File processed and data inserted successfully.")}catch(e){console.error("Error processing file:",e),r.status(500).send("An error occurred while processing the file.")}var a})),t.post("/getHAWB_NO",((e,r)=>{const o=e.body.HAWB_NO;let t,n=[];console.log(o),o?(t="SELECT ae.HAWB_NO FROM air_export_ff ae WHERE ae.MAWB_NO LIKE ? UNION SELECT ae.HAWB_NO FROM air_export_ff ae WHERE ae.HAWB_NO LIKE ? ",n=[`%${o}%`,`%${o}%`]):t="SELECT ae.HAWB_NO FROM air_export_ff ae UNION SELECT ae.MAWB_NO FROM air_export_ff ae ;",c.query(t,n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))})),t.post("/getInvoice",((e,r)=>{const o=e.body.Invoice_No,t=e.body.Division;let n,s=[];console.log(o),o?(n="SELECT ae.InvoiceNo FROM finance_master_data ae WHERE ae.InvoiceNo LIKE ? AND Division=? ",s=[`%${o}%`,t]):n="SELECT ae.InvoiceNo FROM finance_master_data ae ;",c.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))})),t.post("/getHAWB_NOData",((e,r)=>{const o=e.body.HAWB_NO;let t,n=[];if(console.log(o),!o)return r.status(400).send("MAWB_NO  required");t=" SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.MAWB_NO = fm.AirwayBillNo WHERE ae.MAWB_NO = ?   UNION   SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.HAWB_NO = fm.AirwayBillNo WHERE ae.HAWB_NO = ? ",n=[o,o],c.query(" SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.MAWB_NO = fm.AirwayBillNo WHERE ae.MAWB_NO = ?   UNION   SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.HAWB_NO = fm.AirwayBillNo WHERE ae.HAWB_NO = ? ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))})),t.post("/getHAWB_NODataFromInvoice",((e,r)=>{const o=e.body.Invoice_No;let t,n=[];if(console.log(o),!o)return r.status(400).send("MAWB_NO  required");t=" SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.MAWB_NO = fm.AirwayBillNo WHERE ae.MAWB_NO = ( SELECT AirwayBillNo  FROM finance_master_data  WHERE InvoiceNo = ? )   UNION   SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.HAWB_NO = fm.AirwayBillNo WHERE ae.HAWB_NO = ( SELECT AirwayBillNo  FROM finance_master_data  WHERE InvoiceNo =  ? ) ",n=[o,o],c.query(" SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.MAWB_NO = fm.AirwayBillNo WHERE ae.MAWB_NO = ( SELECT AirwayBillNo  FROM finance_master_data  WHERE InvoiceNo = ? )   UNION   SELECT ae.*, fm.* FROM air_export_ff ae LEFT JOIN finance_master_data fm ON ae.HAWB_NO = fm.AirwayBillNo WHERE ae.HAWB_NO = ( SELECT AirwayBillNo  FROM finance_master_data  WHERE InvoiceNo =  ? ) ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))})),e.exports=t},523:(e,r,o)=>{const t=o(572);e.exports=async function(e,r,o,n,s){console.log("Sending Email...");let a={from:`"${e}" <or.neinsoft@nipponexpress.com>`,to:r,cc:o,subject:s,html:n};t.createTransport({host:"95.217.110.90",port:25,secure:!1,auth:{user:"test",pass:"Mypassword1234"},connectionTimeout:1e4,greetingTimeout:5e3,debug:!0}).sendMail(a,((e,r)=>{if(e)return console.log(e);console.log("Message sent: %s",r.messageId)}))}},591:(e,r,o)=>{const{ormdb:t,leavemanagement:n,test:s}=o(935);r.AirImportDahboard=(e,r)=>{let o,n=[];o="  SELECT  * FROM airimport_ff_ftp AS f  WHERE  date(f.createdDate) BETWEEN ? AND ?  AND f.DESTINATION_AIRPROT_CODE=?  AND flag =0 ",n=[e.body.FromDate,e.body.Todate,e.body.BranchCode],t.query("  SELECT  * FROM airimport_ff_ftp AS f  WHERE  date(f.createdDate) BETWEEN ? AND ?  AND f.DESTINATION_AIRPROT_CODE=?  AND flag =0 ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.AirExportDahboard=(e,r)=>{let o,n=[];o="  SELECT  * FROM airexport_ff_ftp AS f  WHERE  date(f.createdDate) BETWEEN ? AND ?  AND f.BRANCH=?  AND flag =0 ",n=[e.body.FromDate,e.body.Todate,e.body.BranchId],t.query("  SELECT  * FROM airexport_ff_ftp AS f  WHERE  date(f.createdDate) BETWEEN ? AND ?  AND f.BRANCH=?  AND flag =0 ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.OceanImportDahboard=(e,r)=>{let o,n=[];o=" SELECT  * FROM ocean_import_ff_ftp AS f  WHERE  date(f.Created_date) BETWEEN  ? AND ?  AND f.Branch_Code=?  AND flag =0 ",n=[e.body.FromDate,e.body.Todate,e.body.BranchId],t.query(" SELECT  * FROM ocean_import_ff_ftp AS f  WHERE  date(f.Created_date) BETWEEN  ? AND ?  AND f.Branch_Code=?  AND flag =0 ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.OceanExportDahboard=(e,r)=>{let o,n=[];o=" SELECT  * FROM ocean_export_ff_ftp AS f  WHERE  date(f.created_date) BETWEEN  ? AND ?  AND f.Branch_Code= ?  AND flag =0  ",n=[e.body.FromDate,e.body.Todate,e.body.BranchId],t.query(" SELECT  * FROM ocean_export_ff_ftp AS f  WHERE  date(f.created_date) BETWEEN  ? AND ?  AND f.Branch_Code= ?  AND flag =0  ",n,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))}},987:(e,r,o)=>{const{ormdb:t,leavemanagement:n,test:s,sqlServerConnection:a}=o(935);r.getAllData=(e,r)=>{console.log("this is iuse login "),console.log(e.body),query="SELECT * FROM `user` WHERE `emp_id` = ? AND  password = ? ",n.query(query,[e.body.userid,e.body.password],((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):(0==o&&r.json("no data found "),r.json(o))}))},r.getAccess=(e,r)=>{console.log("this is getAccess "),console.log(e.body),query="SELECT access_config FROM `user_access` WHERE `user_id` = ? ",t.query(query,[e.body.userid],((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):(0==o&&r.json("no data found "),r.json(o))}))}},958:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935);r.InsertAirExportRemovals=(e,r)=>{console.log("this is Removals Air Export   insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id;o.MAWB_NO,o.HAWB_NO,t.query(" select MAX(sequenceId) as  id from  air_export_removals ",[s,n],((e,a)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const c=(a[0].count||0)+1;o.OR_JOB_NO=s+"/AER"+n+"/"+c,o.sequenceId=c,query="INSERT INTO `air_export_removals` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):r.json(o)}))}))}},392:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935);r.InsertAimportRemovals=(e,r)=>{console.log("this is Removals Air Import   insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id;o.MAWB_NO,o.HAWB_NO,t.query(" select MAX(sequenceId) as  id from  air_import_removals ",[s,n],((e,a)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const c=(a[0].count||0)+1;o.OR_JOB_NO=s+"/AIR"+n+"/"+c,o.sequenceId=c,query="INSERT INTO `air_import_removals` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):r.json(o)}))}))}},534:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935);r.InsertDomasticRemovals=(e,r)=>{console.log("this is Removals  domestic_removals   insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id;o.MAWB_NO,o.HAWB_NO,t.query(" select MAX(sequenceId) as  id from  domestic_removals ",[s,n],((e,a)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const c=(a[0].count||0)+1;o.OR_JOB_NO=s+"/DMR"+n+"/"+c,o.sequenceId=c,query="INSERT INTO `domestic_removals` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):r.json(o)}))}))}},743:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935);r.InsertOceanExportRemovals=(e,r)=>{console.log("this is Removals Ocean Export insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id;o.MAWB_NO,o.HAWB_NO,t.query(" select MAX(sequenceId) as  id from  ocean_export_removals ",[s,n],((e,a)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const c=(a[0].count||0)+1;o.OR_JOB_NO=s+"/OER"+n+"/"+c,o.sequenceId=c,query="INSERT INTO `ocean_export_removals` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):r.json(o)}))}))}},238:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935);r.InsertOceanImportRemovals=(e,r)=>{console.log("this is Removals Ocean import    insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id;o.MAWB_NO,o.HAWB_NO,t.query(" select MAX(sequenceId) as  id from  ocean_import_removals ",[s,n],((e,a)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const c=(a[0].count||0)+1;o.OR_JOB_NO=s+"/OIR"+n+"/"+c,o.sequenceId=c,query="INSERT INTO `ocean_import_removals` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):r.json(o)}))}))}},647:(e,r,o)=>{const{ormdb:t}=o(935);r.getAllData=(e,r)=>{console.log("this si reports air export"),query="SELECT * FROM `air_export_ff` WHERE STR_TO_DATE(`MAWB_DATE`, '%d-%m-%Y') BETWEEN '2024-07-01' AND '2024-07-14';",t.query(query,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))}},626:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935),s=o(84);r.getJobData=(e,r)=>{console.log("This is CHA Air import");const o=e.body.jobNo;if(!o)return r.status(400).send("JOB NO. required");const a=[o];t.query("SELECT Initiator_Name, register_branch, Register_Sub_branch, Created_Date FROM `air_import_custom_brokerage` WHERE `JOB_DOCKET_NO` = ?",a,((e,t)=>e?(console.error(e),r.status(500).send("An error occurred while checking JOB NO. existence")):t.length>0?r.status(404).send(t):void n.then((e=>{e.request().input("jobNo",s.VarChar,o).query("\n                SELECT TOP 1\n                    IWR.Job_No,\n                    OM.Org_Name,\n                    IWR.BE_No,\n                    IWR.BE_Date\n                FROM [Logisys].dbo.ImpWorkReg IWR\n                LEFT JOIN [Logisys].dbo.Organization_Master OM ON IWR.Party_ID = OM.Org_Id\n                WHERE IWR.Job_No LIKE @jobNo\n            ").then((e=>{r.json(e.recordset)})).catch((e=>(console.error(e),r.status(500).send("An error occurred while fetching data from SQL Server"))))})).catch((e=>{console.error(e),r.status(500).send("Failed to connect to SQL Server")}))))},r.InsertChaAimport=(e,r)=>{console.log("this is CHA aIr import  insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,a=o.MAWB_NO,c=o.HAWB_NO;t.query(" select MAX(sequenceId) as  id from  saveAirImportCustomBrokerage ",[s,n],((e,i)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const l=(i[0].count||0)+1;o.OR_JOB_NO=s+"/AIC"+n+"/"+l,o.sequenceId=l,query="INSERT INTO `air_import_custom_brokerage` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(updateMasterStatus(a,c),r.json(o))}))}))}},77:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935),s=o(84);r.getJobData=(e,r)=>{console.log("This is CHA Air EXPORT");const o=e.body.jobNo;if(!o)return r.status(400).send("JOB NO. required");const a=[o];t.query("SELECT Initiator_Name, register_branch, Register_Sub_branch, Created_Date FROM `air_export_custom_brokerage` WHERE `JOB_DOCKET_NO` = ?",a,((e,t)=>e?(console.error(e),r.status(500).send("An error occurred while checking JOB NO. existence")):t.length>0?r.status(404).send(t):(console.log(" job no is not presert in local db "),void n.then((e=>{e.request().input("jobNo",s.VarChar,o).query("\n                SELECT TOP 1\n                    IWR.Job_No,\n                    OM.Org_Name,\n                    IWR.BE_No,\n                    IWR.BE_Date\n                FROM [Logisys].dbo.ImpWorkReg IWR\n                LEFT JOIN [Logisys].dbo.Organization_Master OM ON IWR.Party_ID = OM.Org_Id\n                WHERE IWR.Job_No LIKE @jobNo\n            ").then((e=>{r.json(e.recordset)})).catch((e=>(console.error(e),r.status(500).send("An error occurred while fetching data from SQL Server"))))})).catch((e=>{console.error(e),r.status(500).send("Failed to connect to SQL Server")})))))},r.InsertChaExport=(e,r)=>{console.log("this is CHA aIr EXport  insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,a=o.MAWB_NO,c=o.HAWB_NO;t.query(" select MAX(sequenceId) as  id from  air_export_custom_brokerage ",[s,n],((e,i)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const l=(i[0].count||0)+1;o.OR_JOB_NO=s+"/AEC"+n+"/"+l,o.sequenceId=l,query="INSERT INTO `air_export_custom_brokerage` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(updateMasterStatus(a,c),r.json(o))}))}))}},323:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935),s=o(84);r.getJobData=(e,r)=>{console.log("This is CHA Ocean Export  ");const o=e.body.jobNo;if(!o)return r.status(400).send("JOB NO. required");const a=[o];t.query("SELECT Initiator_Name, register_branch, Register_Sub_branch, Created_Date FROM `ocean_export_custom_brokerage` WHERE `JOB_DOCKET_NO` = ?",a,((e,t)=>e?(console.error(e),r.status(500).send("An error occurred while checking JOB NO. existence")):t.length>0?r.status(404).send(t):void n.then((e=>{e.request().input("jobNo",s.VarChar,o).query("\n                SELECT TOP 1\n                    IWR.Job_No,\n                    OM.Org_Name,\n                    IWR.BE_No,\n                    IWR.BE_Date\n                FROM [Logisys].dbo.ImpWorkReg IWR\n                LEFT JOIN [Logisys].dbo.Organization_Master OM ON IWR.Party_ID = OM.Org_Id\n                WHERE IWR.Job_No LIKE @jobNo\n            ").then((e=>{r.json(e.recordset)})).catch((e=>(console.error(e),r.status(500).send("An error occurred while fetching data from SQL Server"))))})).catch((e=>{console.error(e),r.status(500).send("Failed to connect to SQL Server")}))))},r.InsertChaOExport=(e,r)=>{console.log("this is CHA Ocean  Export  insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,a=o.MAWB_NO,c=o.HAWB_NO;t.query(" select MAX(sequenceId) as  id from  ocean_export_custom_brokerage ",[s,n],((e,i)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const l=(i[0].count||0)+1;o.OR_JOB_NO=s+"/OEC"+n+"/"+l,o.sequenceId=l,query="INSERT INTO `ocean_export_custom_brokerage` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(updateMasterStatus(a,c),r.json(o))}))}))}},784:(e,r,o)=>{const{ormdb:t,sqlServerConnectionPool:n}=o(935),s=o(84);r.getJobData=(e,r)=>{console.log("This is CHA Ocean  import");const o=e.body.jobNo;if(!o)return r.status(400).send("JOB NO. required");const a=[o];t.query("SELECT Initiator_Name, register_branch, Register_Sub_branch, Created_Date FROM `ocean_import_custom_brokerage` WHERE `JOB_DOCKET_NO` = ?",a,((e,t)=>e?(console.error(e),r.status(500).send("An error occurred while checking JOB NO. existence")):t.length>0?r.status(404).send(t):void n.then((e=>{e.request().input("jobNo",s.VarChar,o).query("\n                SELECT TOP 1\n                    IWR.Job_No,\n                    OM.Org_Name,\n                    IWR.BE_No,\n                    IWR.BE_Date\n                FROM [Logisys].dbo.ImpWorkReg IWR\n                LEFT JOIN [Logisys].dbo.Organization_Master OM ON IWR.Party_ID = OM.Org_Id\n                WHERE IWR.Job_No LIKE @jobNo\n            ").then((e=>{r.json(e.recordset)})).catch((e=>(console.error(e),r.status(500).send("An error occurred while fetching data from SQL Server"))))})).catch((e=>{console.error(e),r.status(500).send("Failed to connect to SQL Server")}))))},r.InsertChaOimport=(e,r)=>{console.log("this is CHA Ocean  import  insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,a=o.MAWB_NO,c=o.HAWB_NO;t.query(" select MAX(sequenceId) as  id from  ocean_import_custom_brokerage ",[s,n],((e,i)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const l=(i[0].count||0)+1;o.OR_JOB_NO=s+"/OIC"+n+"/"+l,o.sequenceId=l,query="INSERT INTO `ocean_import_custom_brokerage` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(updateMasterStatus(a,c),r.json(o))}))}))}},965:(e,r,o)=>{const{ormdb:t,leavemanagement:n,test:s}=o(935);r.getAllMaster=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MAWB_BL_NO FROM `airexport_ff_ftp` WHERE `MAWB_BL_NO` LIKE ? AND flag =0 ",s=[`%${o}%`]):n="SELECT DISTINCT MAWB_BL_NO FROM `airexport_ff_ftp` ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getAllMasterFromFF=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MAWB_NO FROM `air_export_ff` WHERE `MAWB_NO` LIKE ? ",s=[`%${o}%`]):n="SELECT DISTINCT MAWB_NO FROM `air_export_ff` ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getMasterData=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MAWB_NO  required");let n=[o];t.query("SELECT * FROM `airexport_ff_ftp` WHERE `MAWB_BL_NO` = ?",n,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking MAWB_NO existence");if(0===n.length)return r.status(404).send("No records found for the provided MAWB_NO");let s=[o];t.query("SELECT * FROM `airexport_ff_ftp` LEFT JOIN newins_iata_codes on DSCODE=DESTINATION_CITY  WHERE `MAWB_BL_NO` = ? AND flag = 0 ",s,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking flags");if(n.length>0)return r.json(n);{let e="\n                  \n                    SELECT Initiator_Name, Register_Branch_Id, Register_Sub_branch,Created_Date FROM air_export_ff WHERE MAWB_NO =? AND flag = 1\n                    LIMIT 1 ;\n                ",n=[o];t.query(e,n,((e,o)=>{if(e)return console.error(e),r.status(500).send("An error occurred while fetching data with user names");r.json(o)}))}}))}))};const a=(e,r)=>{console.log("this is update "),data=[e,r],t.query("UPDATE airexport_ff_ftp SET  flag='1' where MAWB_BL_NO =? AND MASTER_HOUSE_BL =? ",data,((o,t,n)=>{o?console.error(o):console.log("MAWB_BL_NO "+e+"  ANd hawb "+r+" Status has been chnaged ")}))};r.UpdateDataFF=(e,r)=>{console.log("Updating data in the air_export_ff table");const{BUYING_RATE:o,CUSTOMS_CLEARANCE_DATE:n,DUE_CARRIER:s,FREIGHT_AMOUNT:a,IATA_AGENT:c,Industry:i,MARGIN_KG:l,MainProduct:u,NETDUE:_,OperationPic:d,REMARKS:E,SELL_RATE:N,SHIPPER_INVOICE_NO:f,SHIPPING_BILL_DATE:A,SHIPPING_BILL_NO:O,SUB_AGENT:g,SalesPic:h,TOTAL_MARGIN:I,cha:p,clearanceDoneBy:m,salesPicBranch:R}=e.body,B=e.body.MAWB_NO,M=e.body.HAWB_NO,T="\n        UPDATE air_export_ff SET \n            BUYING_RATE = ?, \n            CUSTOMS_CLEARANCE_DATE = ?, \n            DUE_CARRIER = ?, \n            FREIGHT_AMOUNT = ?, \n            IATA_AGENT = ?, \n            Industry = ?, \n            MARGIN_KG = ?, \n            MainProduct = ?, \n            NETDUE = ?, \n            OperationPic = ?, \n            REMARKS = ?, \n            SELL_RATE = ?, \n            SHIPPER_INVOICE_NO = ?, \n            SHIPPING_BILL_DATE = ?, \n            SHIPPING_BILL_NO = ?, \n            SUB_AGENT = ?, \n            SalesPic = ?, \n            TOTAL_MARGIN = ?, \n            cha = ?, \n            clearanceDoneBy = ?, \n            salesPicBranch = ?\n        WHERE MAWB_NO = ? ",S=[o,n,s,a,c,i,l,u,_,d,E,N,f,A,O,g,h,I,p,m,R,B];M&&(T+=" AND HAWB_NO = ?",S.push(M)),t.query(T,S,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while updating the data")):(console.log(`MAWB_BL_NO ${B} and MASTER_HOUSE_BL ${M} status have been updated`),r.json({success:!0,message:"Data updated successfully"}))}))},r.InsertAExport=(e,r)=>{console.log("this is insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,c=o.MAWB_NO,i=o.HAWB_NO;t.query("SELECT MAX(JobCount) as count FROM `air_export_ff` WHERE `Register_Branch_Id`=? AND YEAR(Created_Date)=?",[s,n],((e,l)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const u=(l[0].count||0)+1;o.JOB_DOCKETNO="AEF/"+s+"/"+n+"/"+u,o.JobCount=u,query="INSERT INTO `air_export_ff` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(a(c,i),r.json(o))}))}))},r.getMasterDataFromFF=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MAWB_NO  required");let n=[o];t.query("SELECT * FROM `air_export_ff` WHERE `MAWB_NO` = ?",n,((e,o)=>e?(console.error(e),r.status(500).send("An error occurred while checking MAWB_NO existence")):0===o.length?r.status(404).send("No records found for the provided MAWB_NO"):void r.json(o)))}},546:(e,r,o)=>{const{ormdb:t,leavemanagement:n,test:s,sqlServerConnection:a}=o(935);o(523),r.getAllIndustry=(e,r)=>{query="SELECT * FROM `updatedindustryas` ",t.query(query,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getAllUser=(e,r)=>{query="SELECT u.`user_name`,u.`emp_id`,u.`branch_id`,b.branch_name FROM leavemanagement.`user` u   inner join leavemanagement.branchmaster b on b.branch_id=u.branch_id   WHERE  u.`employee_status`='yes' ",n.query(query,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getAllMaster=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MAWB_NO FROM `airimport_ff_ftp` WHERE `MAWB_NO` LIKE ?  AND flag =0",s=[`%${o}%`]):n="SELECT DISTINCT MAWB_NO FROM `airimport_ff_ftp` ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getMasterData=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MAWB_NO  required");let n=[o];t.query("SELECT * FROM `airimport_ff_ftp` WHERE `MAWB_NO` = ?  ",n,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking MAWB_NO existence");if(0===n.length)return r.status(404).send("No records found for the provided MAWB_NO");let s=[o];t.query("SELECT * FROM `airimport_ff_ftp` INNER JOIN newins_iata_codes on DSCODE=ORIGIN  WHERE `MAWB_NO` = ? AND flag = 0",s,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking flags");if(n.length>0)return r.json(n);{let e="\n                  \n                    SELECT Initiator_Name, Register_Branch_Id, Register_Sub_branch,Created_Date FROM air_import_ff WHERE MAWB_NO =? AND flag = 1\n                    LIMIT 1 ;\n                ",n=[o];t.query(e,n,((e,o)=>{if(e)return console.error(e),r.status(500).send("An error occurred while fetching data with user names");r.json(o)}))}}))}))};const c=(e,r)=>{console.log("this is update "),data=[e,r],t.query("UPDATE airimport_ff_ftp SET  flag='1' where MAWB_NO =? AND HAWB_NO =? ",data,((o,t,n)=>{o?console.error(o):console.log("MAWB_NO "+e+"  ANd hawb "+r+" Status has been chnaged ")}))};r.InsertAExport=(e,r)=>{console.log("this is aIr import  insert ");const o=e.body;console.log("data "+o);const n=(new Date).getFullYear();console.log("Current Year: "+n);const s=o.Register_Branch_Id,a=o.MAWB_NO,i=o.HAWB_NO;t.query("SELECT MAX(JobCount) as count FROM `air_import_ff` WHERE `Register_Branch_Id`=? AND YEAR(Created_Date)=?",[s,n],((e,l)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const u=(l[0].count||0)+1;o.JOB_DOCKETNO="AIF/"+s+"/"+n+"/"+u,o.JobCount=u,query="INSERT INTO `air_import_ff` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(c(a,i),r.json(o))}))}))},r.getAllHawb=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MAWB_NO FROM `air_import_ff` WHERE `MAWB_NO` LIKE ?  AND flag =0",s=[`%${o}%`]):n="SELECT DISTINCT MAWB_NO FROM `air_import_ff` ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getHawbData=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MAWB_NO  required");let n=[o];t.query("SELECT * FROM `air_import_ff` WHERE `MAWB_NO` = ?  ",n,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking MAWB_NO existence");if(0===n.length)return r.status(404).send("No records found for the provided MAWB_NO");let s=[o];t.query("SELECT * FROM `air_import_ff`   WHERE `MAWB_NO` = ? ",s,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking flags");if(n.length>0)return r.json(n);{let e="\n                  \n                    SELECT Initiator_Name, Register_Branch_Id, Register_Sub_branch,Created_Date FROM air_import_ff WHERE MAWB_NO =? AND flag = 1\n                    LIMIT 1 ;\n                ",n=[o];t.query(e,n,((e,o)=>{if(e)return console.error(e),r.status(500).send("An error occurred while fetching data with user names");r.json(o)}))}}))}))}},115:(e,r,o)=>{const{ormdb:t}=o(935);r.getAllMaster=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MBL_No FROM `ocean_export_ff_ftp` WHERE `MBL_No` LIKE ?  AND flag =0",s=[`%${o}%`]):n="SELECT DISTINCT MBL_No FROM `ocean_export_ff_ftp` WHERE flag =0 ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getMasterData=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MBL  required");let n=[o];t.query("SELECT * FROM `ocean_export_ff_ftp` WHERE `MBL_No` = ?  ",n,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking MBL existence");if(0===n.length)return r.status(404).send("No records found for the provided MBL");let s=[o];t.query("SELECT * FROM `ocean_export_ff_ftp`   WHERE `MBL_No` = ? AND flag = 0",s,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking flags");if(n.length>0)return r.json(n);{let e=" SELECT Initiator_Name, Register_Branch_Id, Register_Sub_branch,Created_Date FROM ocean_export_ff WHERE MBL_NO =? AND flag = 1    LIMIT 1 ",n=[o];t.query(e,n,((e,o)=>{if(e)return console.error(e),r.status(500).send("An error occurred while fetching data with user names");r.json(o)}))}}))}))};const n=(e,r)=>{console.log("this is update "),data=[e,r],t.query("UPDATE ocean_export_ff_ftp SET  flag='1' where MBL_No =? AND HBL_No =? ",data,((o,t,n)=>{o?console.error(o):console.log("MBL_No "+e+"  ANd HBL_No "+r+" Status has been chnaged ")}))};r.InsertOExport=(e,r)=>{console.log("this is Ocean  import  insert ");const o=e.body;console.log("data "+o);const s=(new Date).getFullYear();console.log("Current Year: "+s);const a=o.Register_Branch_Id,c=o.MAWB_NO,i=o.HAWB_NO;t.query("SELECT MAX(JobCount) as count FROM `ocean_export_ff` WHERE `Register_Branch_Id`=? AND YEAR(Created_Date)=?",[a,s],((e,l)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const u=(l[0].count||0)+1;o.JOB_DOCKETNO="OIF/"+a+"/"+s+"/"+u,o.JobCount=u,query="INSERT INTO `ocean_export_ff` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(n(c,i),r.json(o))}))}))}},704:(e,r,o)=>{const{ormdb:t}=o(935);r.getAllMaster=(e,r)=>{const o=e.body.MAWB_NO;let n,s=[];console.log(o),o?(n="SELECT DISTINCT  MBL_No FROM `ocean_import_ff_ftp` WHERE `MBL_No` LIKE ?  AND flag =0",s=[`%${o}%`]):n="SELECT DISTINCT MBL_No FROM `ocean_import_ff_ftp` WHERE flag =0 ",t.query(n,s,((e,o)=>{e?(console.error(e),r.status(500).send("An error occurred while fetching data")):r.json(o)}))},r.getMasterData=(e,r)=>{const o=e.body.MAWB_NO;if(!o)return r.status(400).send("MBL  required");let n=[o];t.query("SELECT * FROM `ocean_import_ff_ftp` WHERE `MBL_No` = ?  ",n,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking MBL existence");if(0===n.length)return r.status(404).send("No records found for the provided MBL");let s=[o];t.query("SELECT * FROM `ocean_import_ff_ftp`   WHERE `MBL_No` = ? AND flag = 0",s,((e,n)=>{if(e)return console.error(e),r.status(500).send("An error occurred while checking flags");if(n.length>0)return r.json(n);{let e="\n                  \n                    SELECT Initiator_Name, Register_Branch_Id, Register_Sub_branch,Created_Date FROM ocean_import_ff WHERE MBL_NO =? AND flag = 1\n                    LIMIT 1 ;\n                ",n=[o];t.query(e,n,((e,o)=>{if(e)return console.error(e),r.status(500).send("An error occurred while fetching data with user names");r.json(o)}))}}))}))};const n=(e,r)=>{console.log("this is update "),data=[e,r],t.query("UPDATE ocean_import_ff_ftp SET  flag='1' where MBL_No =? AND HBL_No =? ",data,((o,t,n)=>{o?console.error(o):console.log("MBL_No "+e+"  ANd HBL_No "+r+" Status has been chnaged ")}))};r.InsertOImport=(e,r)=>{console.log("this is Ocean  import  insert ");const o=e.body;console.log("data "+o);const s=(new Date).getFullYear();console.log("Current Year: "+s);const a=o.Register_Branch_Id,c=o.MAWB_NO,i=o.HAWB_NO;t.query("SELECT MAX(JobCount) as count FROM `ocean_import_ff` WHERE `Register_Branch_Id`=? AND YEAR(Created_Date)=?",[a,s],((e,l)=>{if(e)return console.error(e),void r.status(500).send("An error occurred while fetching max JobCount");const u=(l[0].count||0)+1;o.JOB_DOCKETNO="OIF/"+a+"/"+s+"/"+u,o.JobCount=u,query="INSERT INTO `ocean_import_ff` SET  ? ",t.query(query,o,((e,o,t)=>{e?(console.error(e),r.status(500).send("An error occurred while Inserting  data")):(n(c,i),r.json(o))}))}))}},991:(e,r,o)=>{const t=o(252).Router(),n=o(591);t.post("/AirImport",n.AirImportDahboard),t.post("/AirExport",n.AirExportDahboard),t.post("/OceanImport",n.OceanImportDahboard),t.post("/OceanExport",n.OceanExportDahboard),e.exports=t},42:(e,r,o)=>{const t=o(252)(),n=o(987);t.post("/login",n.getAllData),t.get("/Access",n.getAccess),e.exports=t},556:(e,r,o)=>{const t=o(252)(),n=(o(546),o(647));o(704),o(115),t.post("/aefRegister",n.getAllData),e.exports=t},234:(e,r,o)=>{const t=o(252)(),n=o(626),s=o(77),a=o(784),c=o(323);t.post("/ai_JobData",n.getJobData),t.post("/ai_jobinsert",n.InsertChaAimport),t.post("/ae_JobData",s.getJobData),t.post("/ae_jobinsert",s.InsertChaExport),t.post("/oi_JobData",a.getJobData),t.post("/oi_jobinsert",a.InsertChaOimport),t.post("/oe_JobData",c.getJobData),t.post("/oe_jobinsert",c.InsertChaOExport),e.exports=t},315:(e,r,o)=>{const t=o(252)(),n=o(546),s=o(965),a=o(704),c=o(115);t.get("/Industry",n.getAllIndustry),t.get("/User",n.getAllUser),t.post("/ai_AllMaster",n.getAllMaster),t.post("/ai_masterData",n.getMasterData),t.post("/ai_insert",n.InsertAExport),t.post("/ai_AllHawb",n.getAllHawb),t.post("/ai_Hawb",n.getHawbData),t.post("/ae_AllMaster",s.getAllMaster),t.post("/ae_masterData",s.getMasterData),t.post("/ae_insert",s.InsertAExport),t.post("/ae_AllMasterFF",s.getAllMasterFromFF),t.post("/ae_masterDataFF",s.getMasterDataFromFF),t.post("/ae_UpdateDataFF",s.UpdateDataFF),t.post("/oi_AllMaster",a.getAllMaster),t.post("/oi_masterData",a.getMasterData),t.post("/oi_insert",a.InsertOImport),t.post("/oe_AllMaster",c.getAllMaster),t.post("/oe_masterData",c.getMasterData),t.post("/oe_insert",c.InsertOExport),e.exports=t},778:(e,r,o)=>{const t=o(252)(),n=o(392),s=o(958),a=o(238),c=o(743),i=o(534);t.post("/ai_jobinsert",n.InsertAimportRemovals),t.post("/ae_jobinsert",s.InsertAirExportRemovals),t.post("/oi_jobinsert",a.InsertOceanImportRemovals),t.post("/oe_jobinsert",c.InsertOceanExportRemovals),t.post("/Domestic_jobinsert",i.InsertDomasticRemovals),e.exports=t},577:e=>{"use strict";e.exports=require("cors")},48:e=>{"use strict";e.exports=require("csv-parser")},252:e=>{"use strict";e.exports=require("express")},716:e=>{"use strict";e.exports=require("moment")},84:e=>{"use strict";e.exports=require("mssql")},461:e=>{"use strict";e.exports=require("multer")},874:e=>{"use strict";e.exports=require("mysql")},703:e=>{"use strict";e.exports=require("node-cron")},572:e=>{"use strict";e.exports=require("nodemailer")},896:e=>{"use strict";e.exports=require("fs")},692:e=>{"use strict";e.exports=require("https")},928:e=>{"use strict";e.exports=require("path")},23:e=>{"use strict";e.exports=require("util")}},r={};function o(t){var n=r[t];if(void 0!==n)return n.exports;var s=r[t]={exports:{}};return e[t](s,s.exports,o),s.exports}const t=o(252),n=o(896),s=o(577),a=o(703),c=o(692),i=o(315),l=o(234),u=o(991),_=o(778),d=o(321),E=o(556),N=o(42),f=t();f.use(t.json()),f.use(s()),f.use("/ff",i),f.use("/cha",l),f.use("/dashboard",u),f.use("/removals",_),f.use("/finance",d),f.use("/Reports",E),f.use("/User",N),a.schedule("27 16 * * *",(()=>{console.log("Running scheduled task at 16:27 (4:27 PM)")})),console.log("NODE_ENV:","production");{const e={key:n.readFileSync("C:/Users/neinuat/key.pem"),cert:n.readFileSync("C:/Users/neinuat/cert.pem"),ca:n.readFileSync("C:/Users/neinuat/chain.pem")};c.createServer(e,f).listen(5e3,(e=>{e?console.error("Failed to start HTTPS server:",e):console.log("HTTPS Server running on port 5000")}))}})();
//# sourceMappingURL=bundle.js.map